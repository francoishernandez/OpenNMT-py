

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Speech to Text &mdash; OpenNMT-py  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Video to Text" href="vid2text.html" />
    <link rel="prev" title="Image to Text" href="im2text.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OpenNMT-py
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../main.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref.html">References</a></li>
</ul>
<p class="caption"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">How do I use Pretrained embeddings (e.g. GloVe)?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#how-do-i-use-the-transformer-model">How do I use the Transformer model?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#do-you-support-multi-gpu">Do you support multi-gpu?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#how-can-i-ensemble-models-at-inference">How can I ensemble Models at inference?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#how-can-i-weight-different-corpora-at-training">How can I weight different corpora at training?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#how-can-i-apply-on-the-fly-tokenization-and-subword-regularization-when-training">How can I apply on-the-fly tokenization and subword regularization when training?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#what-are-the-readily-available-on-the-fly-data-transforms">What are the readily available on-the-fly data transforms?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#how-can-i-create-custom-on-the-fly-data-transforms">How can I create custom on-the-fly data transforms?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#can-i-get-word-alignments-while-translating">Can I get word alignments while translating?</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/Library.html">Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Translation.html">Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/Summarization.html">Summarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/GGNN.html">Gated Graph Sequence Neural Networks</a></li>
</ul>
<p class="caption"><span class="caption-text">Scripts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../options/build_vocab.html">Build Vocab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../options/train.html">Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../options/translate.html">Translate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../options/server.html">Server</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../onmt.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onmt.modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onmt.translation.html">Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onmt.translate.translation_server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onmt.inputters.html">Data Loaders</a></li>
</ul>
<p class="caption"><span class="caption-text">Legacy</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ (Legacy version)</a></li>
<li class="toctree-l1"><a class="reference internal" href="im2text.html">Image to Text</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Speech to Text</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#acknowledgement">Acknowledgement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vid2text.html">Video to Text</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenNMT-py</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Speech to Text</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/legacy/speech2text.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="speech-to-text">
<h1>Speech to Text<a class="headerlink" href="#speech-to-text" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p><strong>WARNING</strong>: This example is based on the <a class="reference external" href="https://github.com/OpenNMT/OpenNMT-py/tree/legacy">legacy version of OpenNMT-py</a>!</p>
<hr class="docutils" />
<p>A deep learning-based approach to learning the speech-to-text conversion, built on top of the <a href="http://opennmt.net/">OpenNMT</a> system.</p>
<p>Given raw audio, we first apply short-time Fourier transform (STFT), then apply Convolutional Neural Networks to get the source features. Based on this source representation, we use an LSTM decoder with attention to produce the text character by character.</p>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">torchaudio</span></code>: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">sox</span> <span class="pre">libsox-dev</span> <span class="pre">libsox-fmt-all;</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">git+https://github.com/pytorch/audio</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">librosa</span></code>: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">librosa</span></code></p></li>
</ul>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>To get started, we provide a toy speech-to-text example. We assume that the working directory is <code class="docutils literal notranslate"><span class="pre">OpenNMT-py</span></code> throughout this document.</p>
<ol class="simple">
<li><p>Download the data.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">O</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">.</span><span class="n">tgz</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">lstm</span><span class="o">.</span><span class="n">seas</span><span class="o">.</span><span class="n">harvard</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">latex</span><span class="o">/</span><span class="n">speech</span><span class="o">.</span><span class="n">tgz</span><span class="p">;</span> <span class="n">tar</span> <span class="n">zxf</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">.</span><span class="n">tgz</span> <span class="o">-</span><span class="n">C</span> <span class="n">data</span><span class="o">/</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Preprocess the data.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onmt_preprocess</span> <span class="o">-</span><span class="n">data_type</span> <span class="n">audio</span> <span class="o">-</span><span class="n">src_dir</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">an4_dataset</span> <span class="o">-</span><span class="n">train_src</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">train_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">train</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_src</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">val</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">val</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">shard_size</span> <span class="mi">300</span> <span class="o">-</span><span class="n">save_data</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">demo</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Train the model.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onmt_train</span> <span class="o">-</span><span class="n">model_type</span> <span class="n">audio</span> <span class="o">-</span><span class="n">enc_rnn_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">dec_rnn_size</span> <span class="mi">512</span> <span class="o">-</span><span class="n">audio_enc_pooling</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span> <span class="o">-</span><span class="n">dropout</span> <span class="mi">0</span> <span class="o">-</span><span class="n">enc_layers</span> <span class="mi">4</span> <span class="o">-</span><span class="n">dec_layers</span> <span class="mi">1</span> <span class="o">-</span><span class="n">rnn_type</span> <span class="n">LSTM</span> <span class="o">-</span><span class="n">data</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">demo</span> <span class="o">-</span><span class="n">save_model</span> <span class="n">demo</span><span class="o">-</span><span class="n">model</span> <span class="o">-</span><span class="n">global_attention</span> <span class="n">mlp</span> <span class="o">-</span><span class="n">gpu_ranks</span> <span class="mi">0</span> <span class="o">-</span><span class="n">batch_size</span> <span class="mi">8</span> <span class="o">-</span><span class="n">optim</span> <span class="n">adam</span> <span class="o">-</span><span class="n">max_grad_norm</span> <span class="mi">100</span> <span class="o">-</span><span class="n">learning_rate</span> <span class="mf">0.0003</span> <span class="o">-</span><span class="n">learning_rate_decay</span> <span class="mf">0.8</span> <span class="o">-</span><span class="n">train_steps</span> <span class="mi">100000</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Translate the speechs.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onmt_translate</span> <span class="o">-</span><span class="n">data_type</span> <span class="n">audio</span> <span class="o">-</span><span class="n">model</span> <span class="n">demo</span><span class="o">-</span><span class="n">model_acc_x_ppl_x_e13</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span><span class="n">src_dir</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">an4_dataset</span> <span class="o">-</span><span class="n">src</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">val</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">output</span> <span class="n">pred</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">gpu</span> <span class="mi">0</span> <span class="o">-</span><span class="n">verbose</span>
</pre></div>
</div>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-src_dir</span></code>: The directory containing the audio files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-train_tgt</span></code>: The file storing the tokenized labels, one label per line. It shall look like:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">label0_token0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">label0_token1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;</span><span class="n">label0_tokenN0</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">label1_token0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">label1_token1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;</span><span class="n">label1_tokenN1</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">label2_token0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">label2_token1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;</span><span class="n">label2_tokenN2</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-train_src</span></code>: The file storing the paths of the audio files (relative to <code class="docutils literal notranslate"><span class="pre">src_dir</span></code>).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">speech0_path</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">speech1_path</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">speech2_path</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sample_rate</span></code>: Sample rate. Default: 16000.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window_size</span></code>: Window size for spectrogram in seconds. Default: 0.02.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window_stride</span></code>: Window stride for spectrogram in seconds. Default: 0.01.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window</span></code>: Window type for spectrogram generation. Default: hamming.</p></li>
</ul>
</div>
<div class="section" id="acknowledgement">
<h2>Acknowledgement<a class="headerlink" href="#acknowledgement" title="Permalink to this headline">¶</a></h2>
<p>Our preprocessing and CNN encoder is adapted from <a class="reference external" href="https://github.com/SeanNaren/deepspeech.pytorch">deepspeech.pytorch</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vid2text.html" class="btn btn-neutral float-right" title="Video to Text" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="im2text.html" class="btn btn-neutral float-left" title="Image to Text" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, srush

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>